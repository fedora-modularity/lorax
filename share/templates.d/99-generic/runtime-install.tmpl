## lorax template file: populate the ramdisk (runtime image)
<%page args="basearch, product"/>

## anaconda package
installpkg anaconda anaconda-widgets kexec-tools-anaconda-addon
## anaconda deps that aren't in the RPM
installpkg tmux
## for anaconda crash handling
installpkg gdb
## Other available payloads
installpkg dnf

## kernel and firmware
## NOTE: Without explicitly including kernel-modules-extra dnf will choose kernel-debuginfo-*
##       to satify a gfs2-utils kmod requirement
installpkg kernel kernel-modules kernel-modules-extra
installpkg grubby
%if basearch != "s390x":
    ## skip the firmware for sound, video, and scanners, none of which will
    ## do much good for the installer. Also skip uhd-firmware which is not
    ## even a kernel firmware package.
    installpkg --optional *-firmware --except alsa* --except midisport-firmware \
                           --except crystalhd-firmware --except ivtv-firmware \
                           --except cx18-firmware --except iscan-firmware \
                           --except uhd-firmware --except lulzbot-marlin-firmware
    installpkg b43-openfwwf
%endif

## install all of the glibc langpacks since otherwise we get no locales
installpkg glibc-all-langpacks

## arch-specific packages (bootloaders etc.)
%if basearch == "aarch64":
    installpkg efibootmgr grub2-efi-aa64-cdboot grubby shim-aa64
%endif
%if basearch in ("arm", "armhfp"):
    installpkg kernel-lpae
    installpkg uboot-tools
%endif
%if basearch == "i386":
    installpkg kernel-PAE gpart
%endif
%if basearch == "x86_64":
    installpkg grub2-tools-efi
    installpkg efibootmgr
    installpkg shim-x64 grub2-efi-x64-cdboot
    installpkg shim-ia32 grub2-efi-ia32-cdboot
%endif
%if basearch in ("i386", "x86_64"):
    installpkg biosdevname memtest86+ syslinux
    installpkg grub2-tools grub2-tools-minimal grub2-tools-extra
%endif
%if basearch in ("ppc", "ppc64", "ppc64le"):
    installpkg fbset hfsutils kernel-bootwrapper powerpc-utils-core
    installpkg grub2-tools grub2-tools-minimal grub2-tools-extra
    installpkg grub2-${basearch}
%endif
%if basearch == "s390x":
    installpkg lsscsi s390utils-base s390utils-cmsfs-fuse
%endif

## yay, plymouth
installpkg --optional plymouth

## extra dracut modules
installpkg anaconda-dracut dracut-network dracut-config-generic dracut-fips

## rescue needs this
installpkg cryptsetup

## rpcbind or portmap needed by dracut nfs module
installpkg rpcbind

## required for dracut
installpkg kbd kbd-misc
## required for anaconda-dracut (img-lib etc.)
installpkg tar xz curl bzip2

## basic system stuff
installpkg systemd-sysv systemd-units
installpkg --optional rsyslog

## xorg/GUI packages
%if basearch != "s390x":
installpkg xorg-x11-drivers xorg-x11-server-Xorg
%endif
installpkg xorg-x11-server-utils xorg-x11-xauth
installpkg dbus-x11 metacity gsettings-desktop-schemas
installpkg nm-connection-editor
installpkg librsvg2

## filesystem tools
installpkg xfsprogs e2fsprogs
installpkg --optional btrfs-progs jfsutils reiserfs-utils gfs2-utils ntfs-3g ntfsprogs
installpkg --optional system-storage-manager
installpkg device-mapper-persistent-data
installpkg --optional xfsdump

## extra storage packages
installpkg udisks2 udisks2-iscsi

## extra libblockdev plugins
installpkg libblockdev-lvm-dbus

## needed for LUKS escrow
installpkg volume_key
installpkg nss-tools

## SELinux support
installpkg selinux-policy-targeted audit

## network tools/servers
installpkg ethtool openssh-server nfs-utils openssh-clients
installpkg tigervnc-server-minimal
%if basearch != "s390x":
installpkg tigervnc-server-module
%endif
installpkg net-tools
installpkg --optional bridge-utils
installpkg --optional nmap-ncat

## hardware utilities/libraries
installpkg pciutils
%if basearch not in ("aarch64", "ppc64le", "s390x"):
installpkg --optional pcmciautils
%endif
## see bug #1483278
%if basearch not in ("arm", "armhfp"):
    installpkg --optional libmlx4 rdma-core
%endif
installpkg --optional rng-tools

## fonts & themes
installpkg --optional bitmap-fangsongti-fonts
installpkg --optional dejavu-sans-fonts dejavu-sans-mono-fonts
installpkg --optional kacst-farsi-fonts
installpkg --optional kacst-qurn-fonts
installpkg --optional lklug-fonts
installpkg --optional lohit-assamese-fonts
installpkg --optional lohit-bengali-fonts
installpkg --optional lohit-devanagari-fonts
installpkg --optional lohit-gu*-fonts
installpkg --optional lohit-kannada-fonts
installpkg --optional lohit-odia-fonts
installpkg --optional lohit-tamil-fonts
installpkg --optional lohit-telugu-fonts
installpkg --optional madan-fonts
installpkg --optional nhn-nanum-gothic-fonts
installpkg --optional smc-meera-fonts
installpkg --optional thai-scalable-waree-fonts
installpkg --optional vlgothic-fonts
installpkg --optional wqy-microhei-fonts
installpkg --optional sil-abyssinica-fonts
installpkg --optional xorg-x11-fonts-misc
installpkg --optional aajohan-comfortaa-fonts
installpkg --optional abattis-cantarell-fonts
installpkg --optional sil-scheherazade-fonts
installpkg --optional jomolhari-fonts
installpkg --optional khmeros-base-fonts
installpkg --optional sil-padauk-fonts

## debugging/bug reporting tools
installpkg gdb-gdbserver
installpkg libreport-plugin-bugzilla libreport-plugin-reportuploader
installpkg --optional fpaste

## extra tools not required by anaconda
installpkg vim-minimal lsof xz less
installpkg gdisk sg3_utils

## satisfy libnotify's desktop-notification-daemon with the least crazy option
installpkg --optional notification-daemon

## Docker enabled boot.iso
# Not all arches currently have docker
%if basearch not in ("ppc", "ppc64", "s390"):
    installpkg --optional docker-anaconda-addon
%endif

installpkg --optional libibverbs

installpkg spice-vdagent

## actually install all the requested packages
run_pkg_transaction
